<view class="container">

<view class="main-nav">
  <view class="nav-item {{currentMainTab === 0 ? 'active' : ''}}" bindtap="switchMainTab" data-index="{{0}}">
    è®¢å•ç®¡ç†
    <view class="indicator" wx:if="{{currentMainTab === 0}}"></view>
  </view>
  <view class="nav-item {{currentMainTab === 1 ? 'active' : ''}}" bindtap="switchMainTab" data-index="{{1}}">
    èœå“ç®¡ç†
    <view class="indicator" wx:if="{{currentMainTab === 1}}"></view>
  </view>
</view>

<view class="module-content" wx:if="{{currentMainTab === 0}}">
  <view class="header-card">
    <view class="shop-status">
      <view class="shop-info-left">
        <text class="shop-name">è‚¯å¾·åŸº (å¤©åºœå¹¿åœºåº—)</text>
        <view class="status-tag running">è¥ä¸šä¸­</view>
      </view>
      <view class="switch-btn" bindtap="goToUserSide">
        å»ç‚¹é¤ >
      </view>
    </view>

    <view class="stats-row">
      <view class="stat-item">
        <text class="num">{{stats.pending || 0}}</text>
        <text class="label">å¾…æ¥å•</text>
      </view>
      <view class="stat-item">
        <text class="num">{{stats.processing || 0}}</text>
        <text class="label">åˆ¶ä½œä¸­</text>
      </view>
      <view class="stat-item">
        <text class="num">{{stats.completed || 0}}</text>
        <text class="label">ä»Šæ—¥å·²å®Œæˆ</text>
      </view>
    </view>
  </view>

  <view class="tabs">
    <view class="tab {{activeTab==2 ? 'active' : ''}}" bindtap="switchTab" data-status="2">å¾…æ¥å•</view>
    <view class="tab {{activeTab==3 ? 'active' : ''}}" bindtap="switchTab" data-status="3">åˆ¶ä½œä¸­</view>
    <view class="tab {{activeTab==4 ? 'active' : ''}}" bindtap="switchTab" data-status="4">å·²å®Œæˆ</view>
  </view>

  <scroll-view scroll-y class="order-list" refresher-enabled bindrefresherrefresh="onRefresh" refresher-triggered="{{isRefreshing}}">
    <view class="empty-tip" wx:if="{{orders.length === 0}}">æš‚æ— è®¢å•</view>
    
    <block wx:for="{{orders}}" wx:key="id">
      <view class="order-card">
        <view class="card-header">
          <text class="order-num">#{{item.id}}</text>
          <text class="order-time">{{item.orderTimeFormatted}}</text>
        </view>
        
        <view class="order-content">
          <view class="user-info">
             <text>é¡¾å®¢ID: {{item.userId}}</text>
             <text class="price">Â¥{{item.amount}}</text>
          </view>
          <view class="items-desc" wx:if="{{item.remark}}">å¤‡æ³¨: {{item.remark}}</view>
        </view>

        <view class="card-actions">
          <button class="btn-detail" bindtap="viewDetail" data-id="{{item.id}}">æŸ¥çœ‹è¯¦æƒ…</button>
          <button class="btn-primary" wx:if="{{item.status === 2}}" bindtap="updateStatus" data-id="{{item.id}}" data-status="3">ç«‹å³æ¥å•</button>
          <button class="btn-success" wx:if="{{item.status === 3}}" bindtap="updateStatus" data-id="{{item.id}}" data-status="4">é€šçŸ¥å–é¤</button>
        </view>
      </view>
    </block>
    <view style="height: 40rpx;"></view>
  </scroll-view>
</view>

<view class="module-content" wx:if="{{currentMainTab === 1}}">
  <view class="tool-bar">
    <view class="tool-title">å…¨åº—èœå“ ({{products.length}})</view>
    <view class="add-btn-small" bindtap="goToAdd">+ æ–°å»ºèœå“</view>
  </view>

  <scroll-view scroll-y class="product-list">
    <block wx:for="{{products}}" wx:key="id">
      <view class="product-card-manage">
        <image class="p-img" src="{{item.image || '/images/default-food.png'}}" mode="aspectFill"></image>
        
        <view class="p-info">
          <view class="p-header">
            <text class="p-name">{{item.name}}</text>
            <text class="cat-tag">{{item.category || item.categoryName || 'æœªåˆ†ç±»'}}</text>
          </view>
          <view class="p-price">Â¥{{item.price}}</view>
          <view class="p-status">
             <text class="{{item.status===1?'text-green':'text-red'}}">{{item.status===1?'â— å”®å–ä¸­':'â— å·²åœå”®'}}</text>
          </view>
        </view>
        
        <view class="p-actions">
           <switch checked="{{item.status === 1}}" bindchange="toggleStatus" data-id="{{item.id}}" color="#d62f35" style="transform: scale(0.7);"/>
           
           <view class="btn-group">
              <view class="icon-btn edit" bindtap="goToEdit" data-product="{{item}}">âœ</view>
              
              <view class="icon-btn del" bindtap="handleDelete" data-id="{{item.id}}">ğŸ—‘</view>
           </view>
        </view>
      </view>
    </block>
    <view style="height: 100rpx;"></view>
  </scroll-view>
</view>

</view>